<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google</title>
    <link rel="icon" href="https://www.google.com/favicon.ico">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; }
        iframe { width: 100vw; height: 100vh; border: none; position: absolute; top: 0; left: 0; }
        #smart-listener { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: transparent; pointer-events: none; }
        #arcade-view { z-index: 1; display: none; }
        #google-view { z-index: 2; display: block; }
    </style>
</head>
<body>
    <div id="smart-listener" tabindex="0"></div>
    <iframe id="arcade-view" src="src/dashboard.html"></iframe>
    <iframe id="google-view" src="https://www.google.com/search?igu=1"></iframe>

    <script>
        const googleView = document.getElementById('google-view');
        const arcadeView = document.getElementById('arcade-view');
        const listener = document.getElementById('smart-listener');
        let inputBuffer = "";
        const secretKeyword = "play";

        // Listen for "Launch" signals from the Dashboard Iframe
        window.addEventListener("message", (event) => {
            if (event.data.type === "LAUNCH_GAME") {
                const ghost = window.open('about:blank', '_blank');
                const doc = ghost.document;
                doc.title = "Google Docs";
                const icon = doc.createElement('link');
                icon.rel = 'icon'; icon.href = 'https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico';
                doc.head.appendChild(icon);

                const frame = doc.createElement('iframe');
                frame.src = event.data.url;
                frame.style = "position:fixed; top:0; left:0; width:100vw; height:100vh; border:none;";
                doc.body.appendChild(frame);
                doc.body.style.margin = "0";
            }
        });

        function maintainFocus() { if (googleView.style.display !== "none") listener.focus(); }
        window.addEventListener('mousedown', () => setTimeout(maintainFocus, 1000));
        window.addEventListener('keydown', (e) => {
            if (e.key === "Escape") { lock(); return; }
            inputBuffer += e.key.toLowerCase();
            if (inputBuffer.length > 10) inputBuffer = inputBuffer.substring(inputBuffer.length - 10);
            if (inputBuffer.includes(secretKeyword)) { unlock(); inputBuffer = ""; }
        });

        function unlock() { googleView.style.display = "none"; arcadeView.style.display = "block"; document.title = "Google Docs"; }
        function lock() { googleView.style.display = "block"; arcadeView.style.display = "none"; document.title = "Google"; maintainFocus(); }
        window.onblur = () => { lock(); };
        window.onload = () => { maintainFocus(); };
    </script>
</body>
</html>
